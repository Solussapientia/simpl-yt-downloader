<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simpl YT Downloader - Free YouTube Video Downloader</title>
    <meta name="description" content="Download YouTube videos for free in MP4 and MP3 formats. Fast, secure, and easy to use.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon-16x16.png">
    <link rel="apple-touch-icon" href="/static/images/apple-touch-icon.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .error-message {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .format-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl font-bold text-center">
                Simpl YT Downloader
            </h1>
            <p class="text-center text-lg mt-2 opacity-90">
                Free YouTube Video Downloader - Fast & Easy
            </p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- URL Input Section -->
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                <div class="mb-4">
                    <label for="url-input" class="block text-sm font-medium text-gray-700 mb-2">
                        Enter YouTube URL
                    </label>
                    <input 
                        type="text" 
                        id="url-input" 
                        placeholder="Paste your YouTube URL here..."
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    >
                </div>
                
                <button 
                    id="extract-btn"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center"
                >
                    <span id="extract-text">Get Video Info</span>
                    <div id="extract-spinner" class="spinner ml-2 hidden"></div>
                </button>
            </div>
            
            <!-- Error Message -->
            <div id="error-message" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4 hidden error-message">
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <span id="error-text"></span>
                </div>
            </div>
            
            <!-- Video Info Section -->
            <div id="video-info" class="bg-white rounded-lg shadow-lg p-6 mb-6 hidden">
                <div class="flex flex-col md:flex-row gap-6">
                    <!-- Video Details -->
                    <div class="flex-1">
                        <h2 id="video-title" class="text-xl font-bold text-gray-800 mb-2"></h2>
                        <div class="text-gray-600 space-y-1">
                            <p><span class="font-medium">Channel:</span> <span id="video-uploader"></span></p>
                            <p><span class="font-medium">Duration:</span> <span id="video-duration"></span></p>
                            <p><span class="font-medium">Views:</span> <span id="video-views"></span></p>
                        </div>
                    </div>
                    
                    <!-- Thumbnail -->
                    <div class="flex-shrink-0">
                        <img id="video-thumbnail" class="w-full md:w-48 h-auto rounded-lg shadow-md" alt="Video thumbnail">
                    </div>
                </div>
            </div>
            
            <!-- Download Options -->
            <div id="download-options" class="bg-white rounded-lg shadow-lg p-6 hidden">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Download Options</h3>
                
                <div id="format-list" class="space-y-3">
                    <!-- Format options will be populated here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 Simpl YT Downloader. All rights reserved.</p>
            <p class="text-gray-400 text-sm mt-2">
                Download videos responsibly. Respect copyright and terms of service.
            </p>
        </div>
    </footer>

    <script>
        // Global variables
        let currentVideoInfo = null;
        
        // DOM Elements
        const urlInput = document.getElementById('url-input');
        const extractBtn = document.getElementById('extract-btn');
        const extractText = document.getElementById('extract-text');
        const extractSpinner = document.getElementById('extract-spinner');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const videoInfo = document.getElementById('video-info');
        const downloadOptions = document.getElementById('download-options');
        const formatList = document.getElementById('format-list');
        
        // Elements for video info
        const videoTitle = document.getElementById('video-title');
        const videoUploader = document.getElementById('video-uploader');
        const videoDuration = document.getElementById('video-duration');
        const videoViews = document.getElementById('video-views');
        const videoThumbnail = document.getElementById('video-thumbnail');
        
        // Utility functions
        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }
        
        function hideError() {
            errorMessage.classList.add('hidden');
        }
        
        function setLoading(isLoading) {
            if (isLoading) {
                extractText.textContent = 'Extracting...';
                extractSpinner.classList.remove('hidden');
                extractBtn.disabled = true;
                extractBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                extractText.textContent = 'Get Video Info';
                extractSpinner.classList.add('hidden');
                extractBtn.disabled = false;
                extractBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }
        
        function formatDuration(seconds) {
            if (!seconds) return 'Unknown';
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
        }
        
        function formatViews(views) {
            if (!views) return '0';
            if (views >= 1000000) {
                return (views / 1000000).toFixed(1) + 'M';
            } else if (views >= 1000) {
                return (views / 1000).toFixed(1) + 'K';
            }
            return views.toString();
        }
        
        function isValidYouTubeUrl(url) {
            const regex = /^(https?:\/\/)?(www\.)?(youtube|youtu|youtube-nocookie)\.(com|be)\/(watch\?v=|embed\/|v\/|.+\?v=)?([^&=%\?]{11})/;
            return regex.test(url);
        }
        
        // Extract video information
        async function extractVideoInfo() {
            const url = urlInput.value.trim();
            
            if (!url) {
                showError('Please enter a YouTube URL');
                return;
            }
            
            if (!isValidYouTubeUrl(url)) {
                showError('Please enter a valid YouTube URL');
                return;
            }
            
            setLoading(true);
            hideError();
            
            try {
                const response = await fetch('/extract', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'Failed to extract video info');
                }
                
                currentVideoInfo = data.video;
                displayVideoInfo(currentVideoInfo);
                displayDownloadOptions(currentVideoInfo);
                
            } catch (error) {
                showError(error.message || 'Failed to extract video information');
            } finally {
                setLoading(false);
            }
        }
        
        // Display video information
        function displayVideoInfo(video) {
            videoTitle.textContent = video.title;
            videoUploader.textContent = video.uploader;
            videoDuration.textContent = formatDuration(video.duration);
            videoViews.textContent = formatViews(video.view_count);
            videoThumbnail.src = video.thumbnail;
            videoThumbnail.alt = video.title;
            
            videoInfo.classList.remove('hidden');
        }
        
        // Display download options
        function displayDownloadOptions(video) {
            formatList.innerHTML = '';
            
            if (!video.formats || video.formats.length === 0) {
                formatList.innerHTML = '<p class="text-gray-500">No download formats available</p>';
                downloadOptions.classList.remove('hidden');
                return;
            }
            
            video.formats.forEach(format => {
                const formatItem = document.createElement('div');
                formatItem.className = 'format-item flex items-center justify-between p-4 border border-gray-200 rounded-lg transition-all duration-200 hover:bg-gray-50';
                
                formatItem.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div>
                            <div class="font-medium text-gray-800">${format.display_name}</div>
                            <div class="text-sm text-gray-500">${format.quality} • ${format.ext.toUpperCase()}</div>
                        </div>
                    </div>
                    <button onclick="downloadFormat('${video.id}', '${format.format_id}')" 
                            class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200">
                        Download
                    </button>
                `;
                
                formatList.appendChild(formatItem);
            });
            
            downloadOptions.classList.remove('hidden');
        }
        
        // Download format
        function downloadFormat(videoId, formatId) {
            try {
                // Direct download URL
                const downloadUrl = `/download/${videoId}/${formatId}`;
                
                // Create temporary link and click it
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Show success message
                showSuccess('Download started! If it doesn\'t work, try the streaming option.');
                
            } catch (error) {
                // If direct download fails, try streaming
                const streamUrl = `/stream/${videoId}/${formatId}`;
                window.location.href = streamUrl;
            }
        }
        
        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4';
            successDiv.innerHTML = `
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            
            const main = document.querySelector('main');
            main.insertBefore(successDiv, main.firstChild);
            
            setTimeout(() => {
                successDiv.remove();
            }, 5000);
        }
        
        // Event listeners
        extractBtn.addEventListener('click', extractVideoInfo);
        
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                extractVideoInfo();
            }
        });
        
        // Focus on URL input when page loads
        window.addEventListener('load', () => {
            urlInput.focus();
        });
    </script>
</body>
</html> 